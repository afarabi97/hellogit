
<script>
  // Adding this allows this code to be identified in a browser debugger
  //@ sourceURL=server.js
  $(document).ready(function(){

    // This function activates all tooltips on the page
    // See: https://getbootstrap.com/docs/4.1/components/tooltips/ for explanation
    $('[data-toggle="tooltip"]').tooltip();

    // The event object generated here represents the input field of the checkbox
    // selected. target is the DOM element that initated the event. See: https://learn.jquery.com/events/event-basics/
    // The object in this case will be an HTMLInputElement. The parent class of this,
    // Element, has the attribute ID.
    {% for i in range(server_count) %}
    $("#{{ ['is_master_server', i+1] | join('_') }}").change(event, function() {

      // This loops over each checkbox this ISN'T the checkbox that was clicked
      // and flips its disabled status to be the opposite of what it currently is.
      // This has the effect of only allowing one of the master server checkboxes
      // to be selected at any given time.
      $( ".master_server_checkbox" ).not( "#" + event.target.id ).each(function() {
        // This checks to see if the checkbox is or is not already disabled
        // If it is, it flips it to be the opposite.
        // See: https://stackoverflow.com/questions/14913845/jquery-checking-for-disabled-attribute-and-adding-removing-it
        if($(this).is(':disabled')){
          $( "#" + this.id ).prop( "disabled", false );
        } else {
          $( "#" + this.id ).prop( "disabled", true );
        }
      });
    })
    {% endfor %}
  });
</script>

{# This loop goes from 0 to server_count #}
{% for i in range(server_count) %}
<div class="server_slide card">
  <div class="card-header" id="{{ ['server_accordion_header', i+1] | join('_') }}">
    <h5 class="mb-0">
      <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#{{ ['server_collapse', i+1] | join('_') }}" aria-expanded="true" aria-controls="{{ ['server_collapse', i+1] | join('_') }}">
        Server {{ i + 1 }}
      </button>
    </h5>
  </div>
  <div id="{{ ['server_collapse', i+1] | join('_') }}" class="c-ollapse show" aria-labelledby="{{ ['server_accordion_header', i+1] | join('_') }}">
    <div class="card-body">
      {% with button_form_name = ['server_form', i+1] | join('_')
            , button_field_id = form.host_server.field_id + '_' + ((i+1) | string)
            , button_id = form.host_server.button_id + '_' + ((i+1) | string)
            , button_label = form.host_server.label
            , button_text=form.host_server.button_text
            , button_placeholder = form.host_server.placeholder
            , button_field_type = form.host_server.input_type
            , button_constraint = form.host_server.html5_constraint
            , button_required = form.host_server.required
            , button_invalid_feedback = form.host_server.invalid_feedback
            , button_valid_feedback = form.host_server.valid_feedback %}
        {% include "button.html" %}
      {% endwith %}
      <form id='{{ ['server_form', i+1] | join('_') }}' role=form class="needs-validation" novalidate>
      <div class="form-check">
        <input class="form-check-input master_server_checkbox" type="checkbox" value="" id="{{ ['is_master_server', i+1] | join('_') }}">
        <label id='{{ ['is_master_server_label', i+1] | join('_') }}' class="form-check-label" for="{{ ['is_master_server', i+1] | join('_') }}" data-toggle="tooltip" data-placement="right" title='{{ form.server_is_master_server_checkbox.tooltip_text }}'>
          Is Kubernetes master server?
        </label>
      </div>
      </form>
    </div>
  </div>
</div>
{% endfor %}
