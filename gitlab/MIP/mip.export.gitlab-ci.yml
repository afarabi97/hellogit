Clear MIP Software Folders:
  stage: pre-build
  tags:
    - tfplenum-buildv2
  script: |
    echo "IP of runner is $(hostname -I)"
    echo "Current working directory is $(pwd)"

    for folder in $MIP_SOFTWARE_FOLDERS
    do
      rm -f "$SOFTWARE_CPT_EXPORT_LOC/$folder"/*
      mkdir -p "$SOFTWARE_CPT_EXPORT_LOC/$folder/"

      rm -f "$SOFTWARE_MDT_EXPORT_LOC/$folder"/*
      mkdir -p "$SOFTWARE_MDT_EXPORT_LOC/$folder/"
    done
  only:
    variables:
      - $PIPELINE == "export-mip"
      - $PIPELINE == "export-all"


Add Docs to MIP Controller:
  stage: docs
  needs: ["Setup MIP Controller", "Build MIP Offline Documentation"]
  tags:
    - tfplenum-buildv2
  script: |
    echo "IP of runner is $(hostname -I)"
    echo "Current working directory is $(pwd)"
    python3 testing/pipeline/pipeline.py \
    --system-name "MIP" \
    run-export add-docs-to-controller \
    --username "$CONFLUENCE_USERNAME" \
    --password "$CONFLUENCE_PASSWORD" \
    --cpt-export-path "$MIP_CPT_DOC_EXPORT_LOC" \
    --mdt-export-path "$MIP_MDT_DOC_EXPORT_LOC" \
    --export-version "$TFPLENUM_EXPORT_VERSION" \
    --export-hash "$TFPLENUM_EXPORT_HASH" \
    --page-title "$TFPLENUM_CONFLUENCE_PAGE"
  only:
    variables:
      - $PIPELINE == "export-mip"
      - $PIPELINE == "export-all"
  retry: 2
  artifacts:
    untracked: true


Export MIP Controller:
  stage: export
  needs: ["Add Docs to MIP Controller", "Setup MIP Controller"]
  tags:
    - tfplenum-buildv2
  script: |
    echo "IP of runner is $(hostname -i | awk '{print $2}')"
    echo "Current working directory is $(pwd)"
    python3 testing/pipeline/pipeline.py \
    --system-name "MIP" \
    run-export export-mip-ctrl \
    --cpt-export-path "$SOFTWARE_CPT_EXPORT_LOC/$MIP_SOFTWARE_FOLDER" \
    --mdt-export-path "$SOFTWARE_MDT_EXPORT_LOC/$MIP_SOFTWARE_FOLDER" \
    --export-version "$TFPLENUM_EXPORT_VERSION" \
    --export-hash "$TFPLENUM_EXPORT_HASH"
  only:
    variables:
      - $PIPELINE == "export-mip"
      - $PIPELINE == "export-all"
