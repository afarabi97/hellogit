- name: "RHEL-07-040680"
  block:
      - name: "RHEL-07-040680"
        command: rpm -q postfix
        args:
            warn: no
        failed_when: no
        check_mode: no
        changed_when: no
        register: rhel_07_040680_rpm_audit

      - name: "RHEL-07-040680"
        command: "/usr/sbin/postconf -n smtpd_client_restrictions"
        check_mode: no
        changed_when: no
        register: rhel_07_040680_postconf_audit
        when: rhel_07_040680_rpm_audit.rc == 0

      - name: "RHEL-07-040680"
        command: "/usr/sbin/postconf -e 'smtpd_client_restrictions=permit_mynetworks, reject'"
        when:
            - rhel_07_040680_rpm_audit.rc == 0
            - rhel_07_040680_postconf_audit.stdout != 'smtpd_client_restrictions = permit_mynetworks, reject'
  tags:
      - RHEL-07-040680
