# include:
# - template: Container-Scanning.gitlab-ci.yml

variables:
  LABREPO_HOST: "labrepo.sil.lab"

  #EXPORT Variables
  MAIN_FOLDER_VERSION: "3.4"
  GIP_EXPORT_LOC: "/mnt/drive_creation/gip"
  TFPLENUM_EXPORT_VERSION: "$MAIN_FOLDER_VERSION"
  TFPLENUM_EXPORT_HASH: "$CI_COMMIT_SHORT_SHA"
  TFPLENUM_CONFLUENCE_PAGE: "6.8 CVAH 3.3"
  DIP_CONFLUENCE_SETUP_DOCS: "6.8.1.2 DIP System Setup, 6.8.9.2 Setup Controller"
  DIP_CONFLUENCE_USER_DOCS: "6.8.2.1 DIP System Operation"
  DIP_CONFLUENCE_TRAINING_DOCS: "6.8.9.5 Helm Integration"
  DIP_CONFLUENCE_ARCH_DOCS: "6.8.9.5 Helm Integration"
  DIP_CONFLUENCE_MAIN_DOCS: "6.8.9.5 Helm Integration"
  DIP_CONFLUENCE_TROUBLE_DOCS: "6.8.9.5 Helm Integration"
  DIP_CONFLUENCE_VDD_DOCS: "6.8.9.5 Helm Integration"

  MIP_CONFLUENCE_SETUP_DOCS: "6.8.1.1 MIP System Setup, 6.8.2.2 MIP System Operation, 6.8.9.2 Setup Controller"
  MIP_CONFLUENCE_USER_DOCS: "6.8.9.5 Helm Integration"
  MIP_CONFLUENCE_TRAINING_DOCS: "6.8.9.5 Helm Integration"
  MIP_CONFLUENCE_ARCH_DOCS: "6.8.9.5 Helm Integration"
  MIP_CONFLUENCE_MAIN_DOCS: "6.8.9.5 Helm Integration"
  MIP_CONFLUENCE_TROUBLE_DOCS: "6.8.9.5 Helm Integration"
  MIP_CONFLUENCE_VDD_DOCS: "6.8.9.5 Helm Integration"
  LINKED_CLONE: "no"

  #END EXPORT Variables

  PIPELINE: "developer-dip"
  BUILD_TYPE: "clone_from_nightly"
  IS_CLEANUP: "false"
  VMWARE_FOLDER: "Testing"
  NETWORK_ID: "10.40.12.0"
  DIP_NETWORK_BLOCK_INDEX: 0
  MIP_NETWORK_BLOCK_INDEX: 1
  GIP_NETWORK_BLOCK_INDEX: 2
  GIP_SERVICES_NETWORK_BLOCK_INDEX: 4
  RHEL_NETWORK_BLOCK_INDEX: 3
  SONAR_TOKEN: "88288e09065a3d865d20a10c05563b3225566490"
  SONAR_HOST_URL: "http://sonarqube.sil.lab:9000/"
  ACAS_IPADDRESS: "172.16.82.15"
  ACAS_USERNAME: "acas"
  ACAS_PASSWORD: "we.are.tfplenum"
  DIP_ACAS_SCAN_TO_RUN: "DIP Dynamic Scan"
  MIP_ACAS_SCAN_TO_RUN: "MIP Dynamic Scan"
  RUN_ACAS: "false"
  RUN_INTEGRATION: "false"
  DNS_SERVERS: "10.10.101.11 10.10.101.12 10.11.101.13"
  REPO_URL: "https://gitlab.sil.lab/tfplenum/tfplenum.git"
  VCENTER_IPADDRESS: "10.10.103.10"
  VCENTER_DATACENTER: "DEV_Datacenter"
  VCENTER_PORTGROUP: "12-Dev2-Navarro"
  VCENTER_DATASTORE: "dev-vol02"
  DIP_TEMPLATE_TO_CLONE: "nightly-dip-ctrl.lan"
  MIP_TEMPLATE_TO_CLONE: "nightly-mip-ctrl.lan"
  GIP_TEMPLATE_TO_CLONE: "nightly-gip-ctrl.lan"
  GIP_SVC_TEMPLATE_TO_CLONE: "GIP SVC Template"
  MIP_OPERATOR_TYPE: "CPT"
  VM_GATEWAY: "10.40.12.1"
  RHEL_SUB_METHOD: "standard"
  RHEL_ORGANIZATION: "7403688"
  RHEL_ACTIVATIONKEY: "Reposync"
  SAVE_KIT: "No"

  RUN_DIP_STIGS: "true"
  RUN_MIP_STIGS: "true"
  RUN_GIP_STIGS: "true"
  RUN_GIPSVC_STIGS: "true"
  RUN_REPOSYNC_SERVER_STIGS: "true"
  RUN_REPOSYNC_WORKSTATION_STIGS: "true"


  #Master Drive Creation Variables
  MASTER_DRIVE_CREATION_USERNAME: "drive_creator"
  MASTER_DRIVE_CREATION_IPADDRESS: "10.10.102.10"
  MASTER_DRIVE_CREATION_MULTIBOOT_IMG_PATH: "/mnt/drive_creation/v3.4/MULTIBOOT/MULTIBOOT_20200303.img"
  MASTER_DRIVE_CREATION_EXTERNAL_CPT_DRIVE: "/dev/sdb"
  MASTER_DRIVE_CREATION_EXTERNAL_MDT_DRIVE: "/dev/sdc"
  MASTER_DRIVE_CREATION_CPT_MOUNT_POINT: "/mnt/CPTData"
  MASTER_DRIVE_CREATION_MDT_MOUNT_POINT: "/mnt/MDTData"
  RUN_CREATE_MASTER_DRIVE: "false"
  #End

  #The VM prefix is the prefix for all the VMs that will be created.
  #EX <VM_PREFIX>-ctrl.lan | <VM_PREFIX>-sensor1.lan | <VM_PREFIX>-server1.lan
  VM_PREFIX: "test1"
  KIT_DOMAIN: "lan"
  NUM_SERVERS: 2
  NUM_SENSORS: 1
  SERVER_CPU: 32
  SERVER_MEM: 30720
  SENSOR_CPU: 24
  SENSOR_MEM: 30720
  NUM_MIPS: 1
  GIP_NUM_SERVERS: 4
  GIP_SERVER_CPU: 32
  GIP_SERVER_MEM: 65536

  # MinIO
  MINIO_STORAGE_SIZE: 250
  MINIO_MEMORY: 8192
  MINIO_CPU: 2
  MINIO_USE_TLS: "true"

  #THE VARIBALES IN THIS SECTION DO NOT NEED TO BE OVERWRITTEN IN SCHEDULES.
  MASTER_DRIVE_CREATION_CPT_RSYNC_SOURCE: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/CPT/Data/"
  MASTER_DRIVE_CREATION_MDT_RSYNC_SOURCE: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/MDT/Data/"
  SOFTWARE_CPT_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/CPT/Data/CVAH $MAIN_FOLDER_VERSION/Software"
  SOFTWARE_MDT_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/MDT/Data/CVAH $MAIN_FOLDER_VERSION/Software"
  REPO_CPT_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/CPT/Data/CVAH $MAIN_FOLDER_VERSION/Software/VMs/RhelRepo"
  REPO_MDT_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/MDT/Data/CVAH $MAIN_FOLDER_VERSION/Software/VMs/RhelRepo"
  MIP_CPT_DOC_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/CPT/Data/CVAH $MAIN_FOLDER_VERSION/Documentation/MIP"
  MIP_MDT_DOC_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/MDT/Data/CVAH $MAIN_FOLDER_VERSION/Documentation/MIP"
  DIP_CPT_DOC_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/CPT/Data/CVAH $MAIN_FOLDER_VERSION/Documentation/DIP"
  DIP_MDT_DOC_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/MDT/Data/CVAH $MAIN_FOLDER_VERSION/Documentation/DIP"
  APP_STORE_CPT_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/CPT/Data/CVAH $MAIN_FOLDER_VERSION/Software/AppStore"
  APP_STORE_MDT_EXPORT_LOC: "/mnt/drive_creation/v$MAIN_FOLDER_VERSION/MDT/Data/CVAH $MAIN_FOLDER_VERSION/Software/AppStore"

  APP_STORE_DIRECTORY: "PowerShell_Modules"
  DOCS_ARCH_FOLDER: "Architecture"
  DOCS_SETUP_FOLDER: "Setup"
  DOCS_TRAINING_FOLDER: "Training"
  DOCS_USER_FOLDER: "User"
  DOCS_VDD_FOLDER: "VDD"
  DOCS_MAINTENANCE_FOLDER: "Maintenance"
  DOCS_TROUBLESHOOTING_FOLDER: "TroubleShooting"
  DOCS_FOLDERS: "$DOCS_ARCH_FOLDER $DOCS_SETUP_FOLDER $DOCS_TRAINING_FOLDER $DOCS_USER_FOLDER $DOCS_VDD_FOLDER $DOCS_MAINTENANCE_FOLDER $DOCS_TROUBLESHOOTING_FOLDER"

  STACK_SOFTWARE_FOLDER: "Physical_Stack_Build"
  DIP_SOFTWARE_FOLDER: "DIP"
  MIP_SOFTWARE_FOLDER: "MIP"

  DIP_SOFTWARE_FOLDERS: "$STACK_SOFTWARE_FOLDER $DIP_SOFTWARE_FOLDER"
  MIP_SOFTWARE_FOLDERS: "$MIP_SOFTWARE_FOLDER"


stages:
  - code-analysis
  - pre-build
  - build
  - docs
  - kickstart
  - kit
  - configure:minio
  - stig-kit
  - security_scans
  - catalog
  - unit-test
  - integration-test
  - test-powerfailure
  - rerun-integration-test
  - export
  - cleanup
  - hashfiles
  - checkhash
  - publish

include:
  - local: gitlab/code-analysis.yml
  - local: gitlab/DIP/dip.gitlab-ci.yml
  - local: gitlab/DIP/dip.export.gitlab-ci.yml
  - local: gitlab/DIP/dip.docs.gitlab-ci.yml
  - local: gitlab/MIP/mip.gitlab-ci.yml
  - local: gitlab/MIP/mip.export.gitlab-ci.yml
  - local: gitlab/MIP/mip.docs.gitlab-ci.yml
  - local: gitlab/GIP/gip.gitlab-ci.yml
  - local: gitlab/GIP/gip.export.gitlab-ci.yml
  - local: gitlab/Drive/repo.gitlab-ci.yml
  - local: gitlab/Drive/repo.export.gitlab-ci.yml
  - local: gitlab/Drive/powershell.gitlab-export.yml
  - local: gitlab/Drive/drive.create.gitlab-ci.yml
