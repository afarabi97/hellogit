apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}
data:
  setup.sh: |
    #!/bin/sh -e

    scripts_dir='/opt/nifi/scripts'
    [ -f "${scripts_dir}/common.sh" ] && . "${scripts_dir}/common.sh"

    prop_replace 'nifi.flow.configuration.file' "./flowfile_repository/flow.xml.gz"

    # WebCA truststore
    echo "Create WebCA TrustStore"
    keytool -importcert -noprompt -trustcacerts -file /etc/ssl/certs/container/ca.crt -alias webCA -keystore {{ .Values.nifi_base_dir }}/files/webCA.jks -storepass changeit
