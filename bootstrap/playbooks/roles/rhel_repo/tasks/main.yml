---
- name: Setup RHEL Repos
  block:
    - name: Labrepo rhel repos
      get_url:
        url: "https://nexus.sil.lab/repository/tfplenum-repo/nexus-rhel8.repo"
        dest: "/etc/yum.repos.d/nexus-rhel8.repo"
    - name: Disable RHEL License
      replace:
        path: "/etc/yum/pluginconf.d/subscription-manager.conf"
        regexp: 'enabled=1'
        replace: 'enabled=0'

- name: Clean repos
  command: dnf clean all
  ignore_errors: yes
  args:
    warn: false

- name: Clean repo cache
  file:
    path: /var/cache/dnf
    state: absent
...
