---

- name: Set_fact management_interface ipv4
  set_fact:
    management_interface: "{{ ansible_default_ipv4.interface }}"

- name: Remove all nameservers from resolv conf
  lineinfile:
    path: "/etc/sysconfig/network-scripts/ifcfg-{{ management_interface }}"
    regexp: '^DNS[0-9]=.*'
    state: absent

- name: Remove all nameservers from resolv conf
  lineinfile:
    path: "/etc/sysconfig/network-scripts/ifcfg-{{ management_interface }}"
    line: "DNS1=127.0.0.1"
    state: present
  register: mng_iface

- name: Load Configs into NM # noqa 503
  shell: |
    nmcli conn reload
  register: nm_reload
  when: mng_iface.changed

- name: Bring up the connections # noqa 503
  shell: |
    nmcli con up "`nmcli -g GENERAL.CONNECTION dev show {{ management_interface }}`"
  register: results
  when: nm_reload.changed
  changed_when: results.rc == 0

...
