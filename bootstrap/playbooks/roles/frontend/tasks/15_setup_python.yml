---

- name: Include Pip Setup
  include_role:
    name: common
    tasks_from: pip

- name: Stop tfplenum-frontend service
  systemd:
    name: tfplenum-frontend
    enabled: yes
    state: stopped
  ignore_errors: yes

- name: Create Virtual Env
  shell: |
    python3 -m venv {{ web_install_dir }}/tfp-env
  register: results
  changed_when: results.rc == 0

- name: Update Pip
  pip:
    name: pip
    state: forcereinstall
    version: 20.2.4
    virtualenv: "{{ web_install_dir }}/tfp-env"

- name: Install Pip Wheel
  pip:
    name: wheel
    version: 0.35.1
    virtualenv: "{{ web_install_dir }}/tfp-env"

- name: Install Pip Modules from requirements
  pip:
    requirements: "{{ web_install_dir }}/requirements.txt"
    virtualenv: "{{ web_install_dir }}/tfp-env"

# Workaround for pip dep bug
- name: Install Curator Pip Module
  pip:
    name: "elasticsearch-curator"
    version: "5.8.1"
    virtualenv: "{{ web_install_dir }}/tfp-env"
