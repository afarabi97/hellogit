---
- import_role:
    name: rhel_repo
    tasks_from: add_repo
  when: not rpm_install

- name: redis | Install
  dnf:
    name: redis
    state: present
    enablerepo: nexus-yum-proxy
    disablerepo: rhel-8-for-x86_64-appstream-rpms

- import_role:
    name: rhel_repo
    tasks_from: remove_nexus_repos
  when: not rpm_install

- name: Change permissions of redis config file
  file:
    path: /etc/redis.conf
    state: file
    mode: '0644'

- name: Change Owner and group of the log folder
  file:
    path: /var/log/redis
    state: directory
    owner: redis
    group: redis
    recurse: yes

- name: redis | Enable Service
  systemd:
    name: redis
    enabled: yes

# - name: redis | Disable Persistence
#   lineinfile:
#     path: /etc/redis.conf
#     state: absent
#     regexp: '^save'
