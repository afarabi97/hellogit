---
- import_tasks: setup.yml
  tags: setup_registry

- name: Download docker containers from nexus 10 at a time.
  vars:
    durations: "{{ item }}"
  include: pull_docker_batch.yml
  with_items:
    - "{{ kube_images | batch(10) | list }}"
  tags: pull-docker-images

- name: Tag local images for upload to registry
  command: "docker tag {{ item }} localhost:{{ firewall_port }}/{{ item[item.find('/')+1:] }}"
  register: docker_tag_results
  changed_when: docker_tag_results.rc == 0
  with_items:
    - "{{ kube_images }}"
  tags: pull-docker-images

- name: Push docker containers to docker registry in batch of ten items
  vars:
    durations: "{{ item }}"
  include: push_docker_batch.yml
  with_items:
    - "{{ kube_images | batch(10) | list }}"
  tags: pull-docker-images

...
