---
- name: Fetch the mip tar files
  get_url:
    url: "{{ item }}"
    dest: /root
  with_items:
   - "{{ misc_server }}/MIP/{{ mip_version_dir }}/MIP_Images.tar"
   - "{{ misc_server }}/MIP/{{ mip_version_dir }}/2fa_certs.tar"

- name: Unarchive the files.
  unarchive:
    src: "{{ item }}"
    dest: /root
    remote_src: yes
  with_items:
    - /root/MIP_Images.tar
    - /root/2fa_certs.tar

- name: Remove the archive.
  file:
    path: "{{ item }}"
    state: absent
  with_items:
   - /root/MIP_Images.tar
   - /root/2fa_certs.tar

- name: Create a directory in {{ web_root }}.
  file:
    path: "{{ web_root }}/MIP"
    state: directory

- name: Fetch MIP resources.
  get_url:
    url: "{{ misc_server }}/MIP/{{ mip_version_dir }}/{{ item }}"
    dest: "{{ web_root }}/MIP/"
  loop:
    - "{{ vmware_file }}"
    - "{{ vscode_file }}"
    - "{{ gitkraken_file }}"
    - "{{ chrome_file }}"
    - "{{ nexpose_file }}"
    - "{{ burpsuite_file }}"
    - "{{ nvidia_driver }}"
    - "{{ amd_driver }}"

- name: Fetch MIP Resources.
  get_url:
    url: "{{ misc_server }}/MIP/{{ mip_version_dir }}/{{ item }}"
    dest: "{{ web_root }}/MIP/"
  loop:
    - "{{ cpt_archive }}"
    - "{{ mdt_archive }}"
  when: download_archives

- name: "Download direct rpms"
  get_url:
    url: "{{ item.url }}"
    dest: "{{ item.dest }}"
  with_items:
    - "{{ mip_direct_download_rpms }}"
