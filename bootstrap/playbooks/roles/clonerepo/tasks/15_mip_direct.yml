---
- name: Fetch the mip tar files
  get_url:
    url: "{{ item }}"
    dest: /root
  with_items:
   - "{{ mip_repo }}/mip_images/{{ mip_images_tar }}"
   - "{{ mip_repo }}/2fa/{{ twofa_tar }}"

- name: Unarchive the files.
  unarchive:
    src: "{{ item }}"
    dest: /root
    remote_src: yes
  with_items:
    - "/root/{{ mip_images_tar }}"
    - "/root/{{ twofa_tar }}"

- name: Remove the archive.
  file:
    path: "{{ item }}"
    state: absent
  with_items:
   - "/root/{{ mip_images_tar }}"
   - "/root/{{ twofa_tar }}"

- name: Create a directory in {{ web_root }}.
  file:
    path: "{{ web_root }}/MIP"
    state: directory

- name: Fetch MIP resources.
  get_url:
    url: "{{ mip_repo }}/{{ item.src }}"
    dest: "{{ item.dest }}"
  loop:
    - { "src": "vmware/{{ vmware_file }}", "dest": "{{ web_root }}/MIP/" }
    - { "src": "vscode/{{ vscode_file }}", "dest": "{{ extras_dir }}/Packages" }
    - { "src": "gitkraken/{{ gitkraken_file }}", "dest": "{{ extras_dir }}/Packages" }
    - { "src": "google-chrome/{{ chrome_file }}", "dest": "{{ extras_dir }}/Packages" }
    - { "src": "nexpose/{{ nexpose_file }}", "dest": "{{ web_root }}/MIP/" }
    - { "src": "burpsuite/{{ burpsuite_file }}", "dest": "{{ web_root }}/MIP/" }
    - { "src": "drivers/{{ nvidia_driver }}", "dest": "{{ web_root }}/MIP/"}
    - { "src": "drivers/{{ amd_driver }}", "dest": "{{ web_root }}/MIP/"}
