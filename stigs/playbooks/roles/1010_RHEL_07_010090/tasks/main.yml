- name: Set the system_name fact.
  set_fact:
    system_name: "{{ lookup('ini', 'system_name section=tfplenum file=/etc/tfplenum.ini') }}"

- name: Add labrepo to yum.
  block:
    - name: Add the labrepo-rhel-7-server-rpms repository to yum.
      yum_repository:
        name: labrepo-rhel-7-server-rpms
        description: Mirror of the RHEL 7 server rpms repository.
        file: labrepo
        baseurl: http://yum.labrepo.sil.lab/rhel/rhel-7-server-rpms
        gpgcheck: yes
        gpgkey: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release

    - name: Clean the yum cache.
      command: yum clean all
      args:
        warn: no
  when: system_name == "MIP"

- name: "RHEL-07-010090"
  block:
      - name: "RHEL-07-010090"
        command: rpm -q screen tmux
        args:
            warn: no
        check_mode: no
        register: rhel_07_010090_audit
        changed_when: rhel_07_010090_audit.rc > 1
        failed_when: no

      - name: "RHEL-07-010090"
        yum:
            name: "{{ rhel7stig_screen_package }}"
            state: present
        when:
            - rhel_07_010090_audit is changed
  tags:
      - RHEL-07-010090

- name: Remove labrepo from yum.
  block:
    - name: Remove the lab-rhel-7-server-rpms repository from yum.
      yum_repository:
        name: labrepo-rhel-7-server-rpms
        state: absent

    - name: Clean the yum cache.
      command: yum clean all
      args:
        warn: no
  when: system_name == "MIP"