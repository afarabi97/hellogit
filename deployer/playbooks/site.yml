# site.yml is the overall playbook, but all it does is include the other playbooks that are part of the site. For more
# information about the structure see:
# http://docs.ansible.com/ansible/latest/playbooks_best_practices.html
# http://docs.ansible.com/ansible/latest/intro_inventory.html
# We follow the guidance to include naming conventions there.

---
- name: Setup Controller
  hosts: localhost
  any_errors_fatal: true
  roles:
    - setup
  tags: setup

- name: Update Keycloak Client and Controller Shibboleth Configs
  hosts: localhost
  gather_facts: yes
  any_errors_fatal: true
  tasks:
    - import_role:
        name: setup
        tasks_from: update_portal_client
  tags:
    - update_portal_client

- name: Preflight
  hosts: localhost
  any_errors_fatal: true
  roles:
    - preflight
  tags: preflight

- name: Setup DNS Server
  hosts: localhost
  any_errors_fatal: true
  roles:
    - dnsmasq
  tags:
    - dnsmasq
    - dns

- name: Setup NTP Server
  hosts: localhost
  any_errors_fatal: true
  roles:
    - chrony
  tags:
    - chrony

- name: Setup Kickstart server
  hosts: localhost
  any_errors_fatal: true
  roles:
    - kickstart
  tags: kickstart

- name: Generate Profiles
  hosts: localhost
  any_errors_fatal: true
  roles:
    - profiles
  tags:
    - profiles
    - profile
