---

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}
  annotations:
    "helm.sh/hook": "pre-install"
    "helm.sh/hook-weight": "-10"
    "helm.sh/hook-delete-policy": "before-hook-creation"
data:
  logstash.yml: |
    config.reload.automatic: true
    config.reload.interval: 10
    xpack.monitoring.enabled: true
    xpack.monitoring.elasticsearch.hosts: https://{{ .Values.elastic_fqdn }}:{{ .Values.elastic_port }}
    xpack.monitoring.elasticsearch.username: "${ELASTICSEARCH_USERNAME}"
    xpack.monitoring.elasticsearch.password: "${ELASTICSEARCH_PASSWORD}"
    xpack.monitoring.elasticsearch.ssl.certificate_authority: /etc/ssl/certs/elasticsearch-ca.crt
    pipeline.workers: 2
    pipeline.batch.size: 1024


  pipelines.yml: |
    - pipeline.id: zeek
      path.config: "/usr/share/logstash/pipeline/zeek.conf"
    - pipeline.id: beats
      path.config: "/usr/share/logstash/pipeline/beats.conf"