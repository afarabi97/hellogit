---

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-setup
data:
  setup.sh: |
{{ .Files.Get "files/setup.sh" | indent 4 }}

  config_file.sh: |
    #!/bin/sh
    cp /config.json.save /mattermost/config/config.json
    cat /mattermost/config/config.json | jq '.ServiceSettings.SiteURL = "http://mattermost.lan"' > /mattermost/config/config.json.tmp
    cat /mattermost/config/config.json.tmp | jq '.ServiceSettings.ConnectionSecurity = "TLS"' > /mattermost/config/config.json
    cat /mattermost/config/config.json | jq '.ServiceSettings.TLSCertFile = "/etc/ssl/certs/mattermost.crt"' > /mattermost/config/config.json.tmp
    cat /mattermost/config/config.json.tmp | jq '.ServiceSettings.TLSKeyFile = "/etc/ssl/certs/mattermost.key"' > /mattermost/config/config.json
