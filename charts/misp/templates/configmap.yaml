apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-configmap
data:
  config.external.php: |-
{{ .Files.Get "files/config.external.php" | indent 4 }}

  misp.conf: |-
    <VirtualHost *:443>
      ServerAdmin admin@dip.local
      ServerName misp.lan
      DocumentRoot /var/www/MISP/app/webroot
      <Directory /var/www/MISP/app/webroot>
          Options -Indexes
          AllowOverride all
          Order allow,deny
          Allow from all
      </Directory>

      SSLEngine On
      SSLCertificateFile /etc/ssl/certs/misp.crt
      SSLCertificateKeyFile /etc/ssl/certs/misp.key
      SSLCertificateChainFile /etc/ssl/certs/webCA.crt

      LogLevel warn
      ErrorLog /var/log/apache2/misp.local_error.log
      CustomLog /var/log/apache2/misp.local_access.log combined

      ServerSignature Off

      Header always set X-Content-Type-Options nosniff
      Header always set X-Frame-Options SAMEORIGIN
      Header always unset "X-Powered-By"
    </VirtualHost>
