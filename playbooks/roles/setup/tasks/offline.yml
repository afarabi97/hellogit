---

- name: remove epel rpm
  yum:
    name: epel-release
    state: absent

- name: delete all repos matching the below regex
  find:
    paths: /etc/yum.repos.d
    patterns: "^(CentOS|epel|rocknsm|ceph|kuber|ansible).*repo$"
    use_regex: true
  register: wildcard_files_to_delete

- name: remove matched repos
  file:
    path: "{{ item.path }}"
    state: absent
  with_items: "{{ wildcard_files_to_delete.files }}"

- name: Disable Red Hat repos...
  rhsm_repository:
    name: "{{ item }}"
    state: disabled
  with_items: "{{ rhel_repos }}"
  when: "ansible_distribution == 'RedHat'"
  ignore_errors: yes

- name: RedHat Yum Repos
  template:
    src: templates/rhel-offline.repo
    dest: "/etc/yum.repos.d/offline.repo"
  when: "ansible_distribution == 'RedHat'"

- name: CentOS Yum Repos
  template:
    src: templates/centos-offline.repo
    dest: "/etc/yum.repos.d/offline.repo"
  when: "ansible_distribution == 'CentOS'"

- name: create pip dir
  file:
    path: "~/.pip"
    state: directory

- name: Add pip config
  template:
    src: templates/pip.conf.j2
    dest: "~/.pip/pip.conf"
