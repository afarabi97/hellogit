input {
  kafka {
    topics => ["suricata-raw"]
    # Set this to one per kafka partition to scale up
    #consumer_threads => 4
    group_id => "logstash_suricata"
    client_id => "logstash_suricata"
    bootstrap_servers => "{{ kafka_url }}.default.svc.cluster.local:{{ kafka_port }}"
    codec => json
    auto_offset_reset => "earliest"
    type => "suricata"
  }
{% for host in groups['remote-sensors'] %}
  kafka {
    topics => ["suricata-raw"]
    # Set this to one per kafka partition to scale up
    #consumer_threads => 4
    group_id => "logstash_suricata"
    client_id => "logstash_suricata-{{ hostvars[host].inventory_hostname_short }}"
    bootstrap_servers => "kafka-{{ hostvars[host].inventory_hostname_short }}.default.svc.cluster.local:{{ kafka_port }}"
    codec => json
    auto_offset_reset => "earliest"
  }
{% endfor %}
}

filter {
  if [type] == "suricata" {
    json {
      source => "message"
      remove_field => "message"
    }
  }
}
