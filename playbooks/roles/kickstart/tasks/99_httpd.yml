---
- name: Configure web server
  block:      
    - name: Install packages
      yum:
        name: "{{ apache }}"
        state: latest
    
    - name: Create directory for {{ os_name }}
      file:
        state: directory
        owner: root
        group: root
        mode: 0755
        setype: httpd_sys_content_t
        path: "{{ item }}"
      with_items:
      - "{{ web_root }}/{{ os_name }}"

    - name: Copy content to {{ web_root }}/{{ os_name }}
      delegate_to: "{{ inventory_hostname }}"
      synchronize:
        dest: "{{ item }}"
        src:  "{{ mnt_pth }}/"
        recursive: yes
      with_items: 
      - "{{ web_root }}/{{ os_name }}/"
    
    - name: Remove apache welcome page
      file:        
        path: /etc/httpd/conf.d/welcome.conf
        state: absent
       
    - name: Start the {{ apache }} service
      service:
        name: "{{ apache }}"
        state: started
        enabled: true

    - name: Configure the firewall
      firewalld:
        service: "{{ item }}"
        immediate: yes
        permanent: yes
        state: enabled
      loop:
      - "http"
      - "https"
  when:
  - os_name != ""