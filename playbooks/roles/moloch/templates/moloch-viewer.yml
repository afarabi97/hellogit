---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: moloch-viewer
  labels:
    component: moloch-viewer
spec:
  replicas: 1
  selector:
    matchLabels:      
      component: moloch-viewer
  template:
    metadata:
      labels:
        component: moloch-viewer
    spec:
      containers:
      - name: moloch-viewer
        image: "{{ moloch_viewer_image }}:{{ moloch_viewer_tag }}"
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: {{ moloch_port }}
          name: webgui
        volumeMounts:
        - name: vars
          mountPath: /etc/icdm/
        - name: templates
          mountPath: /etc/icdm/templates/
        - name: configs
          mountPath: /etc/icdm/conf/
        - name: auto-init
          mountPath: /tmp/auto_init
          subPath: auto_init
      volumes:
      - name: auto-init
        configMap:
          name: moloch-bootstrap
      - name: vars
        configMap:
          name: vars
      - name: configs
        configMap:
          name: moloch
          items:
          - key: config-viewer.ini.conf
            path: config-viewer.ini.conf
      - name: templates
        configMap:
          name: moloch
          items:
          - key: config.ini.tmpl
            path: config.ini.tmpl
      nodeSelector:
        role: server