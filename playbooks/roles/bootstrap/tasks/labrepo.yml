---

- name: remove epel rpm
  yum:
    name: epel-release
    state: absent

- name: delete all repos matching the below regex
  find:
    paths: /etc/yum.repos.d
    patterns: "^(CentOS|epel|rocknsm|ceph|kuber|ansible|mongodb).*repo$"
    use_regex: true
  register: wildcard_files_to_delete

- name: remove matched repos
  file:
    path: "{{ item.path }}"
    state: absent
  with_items: "{{ wildcard_files_to_delete.files }}"

- name: Disable Red Hat repos...
  rhsm_repository:
    name: "{{ item }}"
    state: disabled
  with_items: "{{ rhel_repos }}"
  ignore_errors: yes
  when: "ansible_distribution == 'RedHat'"

- name: Download labrepo file  
  get_url:
    url: http://yum.labrepo.lan/labrepo-rhel.repo
    dest: /etc/yum.repos.d/labrepo-rhel.repo
    mode: 0664
  when: "ansible_distribution == 'RedHat'"

- name: CentOS Yum Repos
  get_url:
    url: http://yum.labrepo.lan/labrepo-centos.repo
    dest: /etc/yum.repos.d/labrepo-rhel.repo
    mode: 0664  
  when: "ansible_distribution == 'CentOS'"

- name: create pip dir
  file:
    path: "~/.pip"
    state: directory

- name: Add pip config
  template:
    src: templates/labrepo-pip.conf.j2
    dest: "~/.pip/pip.conf"

- name: Disable RHEL License
  replace:    
    path: "/etc/yum/pluginconf.d/subscription-manager.conf"
    regexp: 'enabled=1'
    replace: 'enabled=0'
  when: "ansible_distribution == 'RedHat'"
