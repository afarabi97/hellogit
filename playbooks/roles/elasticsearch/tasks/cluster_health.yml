---

- name: Get elasticsearch cluster health
  uri:
    url: "{{ elastic_uri }}/_cluster/health"
  register: elasticsearch_health_result
  until: elasticsearch_health_result.json.status == 'green'
  retries: 10
  delay: 5
  ignore_errors: yes

- name: Test | Elasticsearch cluster should be green
  assert:
    that: elasticsearch_health_result.json.status == 'green'
    msg: "Elasticsearch cluster health check failed.  ES Cluster is currently {{ elasticsearch_health_result.json.status }}."

...