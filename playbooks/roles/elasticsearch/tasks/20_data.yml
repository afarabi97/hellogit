- name: Create ES Data Config
  shell: |
    kubectl create configmap elastic-data --from-file {{ elastic_dir }}/{{ item }}
  with_items:
    - es-data-conf.yml
  when: separate_data

- name: Deploy ES Data
  include_role:
    name: kubernetes/common
    tasks_from: kube_create
  vars:
    name: "Elasticsearch Data Service"
    file_name: "{{ elastic_dir }}/{{ item }}"
  with_items:
    - es-data-svc.yml
    - es-data-statefulset.yml

- name: Wait for Elasticsearch to be ready
  import_role:
    name: kubernetes/common
    tasks_from: kube_wait
  vars:
    type: "statefulset"
    namespace: "default"
    resource_name: "es-data"
    label: ""
