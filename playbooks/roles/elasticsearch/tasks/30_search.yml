- name: Create ES Search Config
  shell: |
    kubectl create configmap elastic-search --from-file {{ elastic_dir }}/{{ item }}
  with_items:
    - es-search-conf.yml

- name: Deploy ES Search Service
  include_role:
    name: kubernetes/common
    tasks_from: kube_create
  vars:
    name: "Elasticsearch search Service"
    file_name: "{{ elastic_dir }}/{{ item }}"
  with_items:
    - es-search-svc.yml

- name: Deploy Pods
  include_role:
    name: kubernetes/common
    tasks_from: kube_create
  vars:
    name: "Elasticsearch Pods"
    file_name: "{{ elastic_dir }}/{{ item }}"
  with_items:
    - es-search-deploy.yml

- name: Wait for Elasticsearch to be ready
  import_role:
    name: kubernetes/common
    tasks_from: kube_wait
  vars:
    type: "deployments"
    namespace: "default"
    resource_name: "es-search"
    label: ""
