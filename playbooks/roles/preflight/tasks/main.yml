---
- name: Check if tfplenum vars exists
  stat:
    path: "{{ tfplenum_vars }}"
  register: vars_result

# TODO: This will install tfplenum rpm when its ready
# For now git clone the di2e repo to /opt/rock/tfplenum
#- name: Install tfplenum rpm
#  yum:
#    name: tfplenum
#    state: present
#  when: vars_result.stat.exists == false

#- name: Check if tfplenum vars exists again
#  stat:
#    path: "{{ install_dir }}/tfplenum/group_vars/all/versions.yml"
#  register: vars_result

- name: Missing tfplenum repo
  fail:
    msg: "Missing tfplenum repo.  Please run tag setup"
  when: vars_result.stat.exists == false

- name: check for offline var
  fail:
    msg: "offline variable is missing.  Please review sample inventory."
  when: offline is not defined or offline is none

- name: offline and pull repos conflicting
  fail:
    msg: "Verify offline variable and {{ item }}.  {{ item }} cannot be true when offline is true."
  when: offline is defined and offline 
    and item is defined and item == true
  with_items:
    - "pull_all_repos"
    - "pull_centos_repos"
    - "pull_rhel_repos"
    - "pull_additional_repos"
  args:
    warn: false