---

- name: Delete existing config directory
  file:
    path: "{{ suricata_dir }}"
    state: absent

- name: Create directories
  file:
    path: "{{ suricata_dir }}/custom"
    owner: root
    group: root
    mode: u+rw,g+rw
    state: directory

- name: Create dummy rule file
  file:
    path: "{{ suricata_dir }}/custom/custom.rules"
    owner: root
    group: root
    mode: u+rw,g+rw
    state: touch

- name: Setup bootstrap deployment
  template:
    src: "templates/bootstrap.yml.j2"
    dest: "{{ suricata_dir }}/bootstrap.yml"
    owner: root
    group: root
    mode: 0644
  when: inventory_hostname in groups['master-server']

- name: Setup configs
  template:
    src: "templates/{{ item }}.j2"
    dest: "{{ suricata_dir }}/{{ item }}"
    group: root
    owner: root
    mode: 0644
  loop: ['suricata.yaml', 'filebeat.yml']
  when: inventory_hostname in groups['suricata']

- name: Setup deployment configs
  template:
    src: "templates/deploy.yml.j2"
    dest: "{{ suricata_dir }}/{{ item }}-deploy.yml"
    owner: root
    group: root
    mode: 0644
  vars:
    hostname: "{{ item }}"
  loop: "{{ groups['suricata'] }}"
  when: inventory_hostname in groups['master-server']

...
