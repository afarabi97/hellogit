---
- name: "Install httpd so this repo can be published"
  yum:
    name: httpd
    state: present

- name: "Start httpd"
  service: 
    name: httpd
    state: started
    enabled: yes

- name: Copy httpd conf to proxy yum repos
  copy:
    src: yum_proxy.conf
    dest: /etc/httpd/conf.d/yum_proxy.conf
    mode: 0644
    owner: root
    group: root
  register: yum_proxy_conf
  when: (clone_repos is defined and clone_repos == false)

- name: Remove yum proxy
  file:
    path: /etc/httpd/conf.d/yum_proxy.conf
    state: absent  
  when: (clone_repos is defined and clone_repos)

- name: "Open up port 80 to allow access"
  firewalld: 
    service: "{{ item }}"
    permanent: true
    immediate: true
    state: enabled
  loop:
  - "http"
  - "https"
  notify: "Restart Docker"

- name: "Start httpd"
  service: 
    name: httpd
    state: restarted
    enabled: yes
  when: yum_proxy_conf is defined and yum_proxy_conf.changed
  