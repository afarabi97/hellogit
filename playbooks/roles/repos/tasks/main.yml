---
- name: remove epel rpm
  yum:
    name: epel-release
    state: absent

- name:  Remove Repos
  file:
    path: "/etc/yum.repos.d/{{ item }}.repo"
    state: absent
  with_items:
  - "{{ CentOS_Repos }}"
  - epel
  - epel-testing

- name: create list
  set_fact:
    host_list: "{{ groups['master-server'] }} + {{ groups['servers'] }} + {{ groups['sensors'] }} + {{ groups['remote-sensors'] }}"

- name: Copy over hosts template
  template:
    src: templates/hosts.j2
    dest: "/etc/hosts"

- name: remove old repo file
  file:
    path: "/etc/yum.repos.d/offline.repo"
    state: absent

- get_url:
    url: "{{ offline_repo_base }}/offline.repo"
    dest: /etc/yum.repos.d/offline.repo
    mode: 0664

- name: Clean repo cache
  shell: |
    rm -rf /var/cache/yum
  args:
    warn: false

- name: create pip dir
  file:
    path: "~/.pip"
    state: directory

- name: Add pip config
  template:
    src: templates/pip.conf.j2
    dest: "~/.pip/pip.conf"