<div class="main-content2">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Page Instructions</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="pageInstructions" style="padding: 0px">
        <p>
          This page is used for adding and removing Nodes from the Kuberenetes Cluster.
        </p>
      </div>
    </mat-card-content>
  </mat-card>
  <mat-card>
    <mat-card-header>
      <mat-card-title>Kit Setup</mat-card-title>
    </mat-card-header>
    <mat-card-content fxLayout="column" fxLayoutAlign="space-around stretch">
      <table mat-table [dataSource]="controlPlaneNodes" aria-describedby="Kit Setup Nodes">
        <!-- Hostname -->
        <ng-container matColumnDef="hostname">
            <th scope="col" mat-header-cell *matHeaderCellDef>Hostname</th>
            <td  mat-cell *matCellDef="let node;"><a (click)="showNodeInfo(node)">{{ node.hostname }}</a></td>
        </ng-container>

        <!-- IP Address -->
        <ng-container matColumnDef="ip_address">
          <th scope="col" mat-header-cell *matHeaderCellDef>IP Address</th>
          <td mat-cell *matCellDef="let node;">{{ node.ip_address }}</td>
        </ng-container>

        <!-- Node Type -->
        <ng-container matColumnDef="node_type">
          <th scope="col" mat-header-cell *matHeaderCellDef>Node Type</th>
          <td mat-cell *matCellDef="let node;">{{ node.node_type }}</td>
        </ng-container>

        <!-- State -->
        <ng-container matColumnDef="state">
          <th scope="col" mat-header-cell *matHeaderCellDef>State</th>
          <td mat-cell *matCellDef="let node;">
            <app-node-state-progress-bar [jobs]="node.jobs"></app-node-state-progress-bar>
          </td>
        </ng-container>

        <!-- Table Rows -->
        <tr mat-header-row *matHeaderRowDef="setupNodesColumns"></tr>
        <tr mat-row *matRowDef="let rowData; columns: setupNodesColumns;"></tr>
    </table>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="warn"
              (click)="refreshKit()" [disabled]="disabledRKbutton()">Refresh Kit</button>
      <!--<button mat-raised-button color="primary"
              (click)="setupMinIO()">Setup MinIO</button>-->
      <button mat-raised-button color="primary"
              (click)="setupCtrlPlane()" [disabled]="disableSCPbutton()">Setup Control Plane</button>
    </mat-card-actions>
  </mat-card>
  <br />
  <mat-card>
    <mat-card-header>
      <mat-card-title>Node Management</mat-card-title>
    </mat-card-header>
    <mat-card-content fxLayout="column" fxLayoutAlign="space-around stretch">
      <table mat-table [dataSource]="nodes" aria-describedby="Kit Setup Nodes">
        <!-- Hostname -->
        <ng-container matColumnDef="hostname">
            <th scope="col" mat-header-cell *matHeaderCellDef>Hostname</th>
            <td mat-cell *matCellDef="let node;"><a (click)="showNodeInfo(node)">{{ node.hostname }}</a> <mat-icon *ngIf="getVpnStatus(node)" mat-list-icon>vpn_key</mat-icon></td>
        </ng-container>

        <!-- Ip Address -->
        <ng-container matColumnDef="ip_address">
          <th scope="col" mat-header-cell *matHeaderCellDef>Ip Address</th>
          <td mat-cell *matCellDef="let node;">{{ node.ip_address }}</td>
        </ng-container>

        <!-- Node Type -->
        <ng-container matColumnDef="node_type">
          <th scope="col" mat-header-cell *matHeaderCellDef>Node Type</th>
          <td mat-cell *matCellDef="let node;">{{ node.node_type }}</td>
        </ng-container>


        <!-- Deployment Type -->
        <ng-container matColumnDef="deployment_type">
          <th scope="col" mat-header-cell *matHeaderCellDef>Deployment Type</th>
          <td mat-cell *matCellDef="let node;">{{ node.deployment_type }}</td>
        </ng-container>

        <!-- State -->
        <ng-container matColumnDef="state">
          <th scope="col" mat-header-cell *matHeaderCellDef>State</th>
          <td mat-cell *matCellDef="let node;">
              <app-node-state-progress-bar [jobs]="node.jobs"></app-node-state-progress-bar>
          </td>
        </ng-container>


        <!-- Actions -->
        <ng-container matColumnDef="actions">
          <th scope="row" mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let node; let j = index;">
              <div class="btn-group">
                <button *ngIf="canDeleteNode(node)" mat-button matTooltip="Delete Node"
                        (click)="canRemove(node)"
                        color="warn" [disabled]="node.isRemoving">
                  <em class="material-icons">delete</em>
                </button>

                <button *ngIf="canGatherFacts(node)" mat-button
                matTooltip="Refresh Device Facts" color="primary"
                (click)="updateGatherFacts(node)">
                <em class="material-icons">refresh</em>
              </button>

              <!--BUTTONS WILL BE REPLACED WITH JOB PROGRESS BAR
              <div class="btn-group" *ngIf="isJobRunningButtonGroup(node)">
                <button mat-button matTooltip="Cancel Job" color="warn"
                        (click)="stopNodeJob(node)">
                  <em class="material-icons">stop</em>
                </button>
              </div>
              -->

                <button *ngIf="isISOButtonGroup(node)" mat-button
                        matTooltip="Download OpenVPN Certificates" color="primary"
                        (click)="downloadOpenVPNCerts(node)">
                    <em class="material-icons">cloud_download</em>
                </button>

              </div>
              <!--BUTTONS WILL BE REPLACED WITH JOB PROGRESS BAR
              <div class="btn-group" *ngIf="isErrorButtonGroup(node)">
                <button mat-button
                        matTooltip="Retry Job" color="primary"
                        (click)="retryNodeJob(node)">
                    <em class="material-icons">refresh</em>
                </button>
              </div>
              -->
          </td>
      </ng-container>

        <!-- Table Rows -->
        <tr mat-header-row *matHeaderRowDef="nodesColumns"></tr>
        <tr mat-row *matRowDef="let rowData; columns: nodesColumns;"></tr>
    </table>
    </mat-card-content>
    <mat-card-actions>
      <button mat-raised-button color="primary"
              (click)="addNode()" [disabled]="disableAddNodeButton()">Add Node</button>
      <button mat-raised-button color="primary" [disabled]="disableDeployKitButton()"
              (click)="deployKit()">Deploy Kit</button>
      <button mat-raised-button color="primary"
              matTooltip="Download ISO" color="primary"
              (click)="downloadISO()" *ngIf="isoSensorExists">Download ISO</button>
    </mat-card-actions>
  </mat-card>
</div>
