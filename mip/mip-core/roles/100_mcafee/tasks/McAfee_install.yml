---
- name: Copy McAfee nails.option file for silent installation
  copy:
    src: nails
    dest: /root/nails.options
    mode: '0664'
  tags:
    - CPT
    - MDT

- name: Unpack McAfee tar file
  unarchive:
    src: "{{ tmp_apps }}/{{ McAfee_file }}"
    dest: "{{ tmp_apps }}"
    remote_src: yes
  tags:
    - CPT
    - MDT

- name: Install rpms required for McAfee
  yum:
    name: "{{ item }}"
    state: present
  loop: "{{ McAfee_packages }}"
  tags:
    - CPT
    - MDT

- name: Check if NAI directory exists
  stat:
    path: /opt/NAI
  register: stat_result
  tags:
    - CPT
    - MDT

- name: Execute McAfee installer
  command: "bash {{ McAfee_installer }}"
  args:
    chdir: "{{ tmp_apps }}/{{ McAfee_dir }}"
  when: not stat_result.stat.exists
  tags:
    - CPT
    - MDT

- name: Remove nails.options file
  file:
    path: /root/nails.options
    state: absent
  tags:
    - CPT
    - MDT

- name: Copy cronjob for automatic dat file update
  copy:
    src: dat_cronjob
    dest: /var/spool/cron/root
    mode: '0600'
  tags:
    - CPT
    - MDT
...
