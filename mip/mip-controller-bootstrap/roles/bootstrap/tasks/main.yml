---
- name: "Start the httpd service."
  service:
    name: httpd
    state: started
    enabled: yes

- name: "Add port 80/443 to firewalld."
  firewalld:
    service: "{{ item }}"
    permanent: true
    immediate: true
    state: enabled
  loop:
    - "http"
    - "https"

- name: Fetch the RHEL ISO.
  get_url:
    url: "{{ isos_server }}/{{ rhel_iso }}"
    dest: /root

- name: Fetch the files to be copied archive.
  get_url:
    url: "{{ misc_server }}/MIP/Files_To_Be_Copied_Over.tar"
    dest: /root

- name: Unarchive the files.
  unarchive:
    src: /root/Files_To_Be_Copied_Over.tar
    dest: /root
    remote_src: yes

- name: Remove the archive.
  file:
    path: /root/Files_To_Be_Copied_Over.tar
    state: absent

- name: Create a directory in {{ web_root }}.
  file:
    path: "{{ web_root }}/MIP"
    state: directory

- name: Fetch MIP resources.
  get_url:
    url: "{{ misc_server }}/MIP/{{ item }}"
    dest: "{{ web_root }}/MIP/"
  loop:
    - "{{ vmware_file }}"
    - "{{ vscode_file }}"
    - "{{ gitkraken_file }}"
    - "{{ chrome_file }}"
    - "{{ wireshark_file }}"
    - "{{ McAfee_file }}"
    - "{{ dat_file }}"
    - "{{ engine_file }}"
    - "{{ nexpose_file }}"
    - "{{ burpsuite_file }}"
    - "{{ ostinato_file }}"
    - "{{ ostinato_server_file }}"
    - "{{ mcafee_gip_file }}"

- name: Fetch MIP Resources.
  get_url:
    url: "{{ misc_server }}/MIP/{{ item }}"
    dest: "{{ web_root }}/MIP/"
  loop:
    - "{{ cpt_archive }}"
    - "{{ mdt_archive }}"
  when: download_archives

- name: Install the httpd package.
  yum:
    name: httpd
    state: latest

- name: Install the tftp-server,syslinux, and xinetd packages.
  yum:
    name: tftp-server,syslinux,xinetd
    state: latest

- name: Install dhcp package.
  yum:
    name: dhcp
    state: latest

- name: "Install bootstrap packages"
  yum:
    name: "{{ bootstrap_package_names }}"
    state: present

- name: Remove repositories that were found in /etc/yum.repos.d.
  file:
    path: "{{ item }}"
    state: absent
  loop:
    - /etc/yum.repos.d/labrepo-rhel.repo
    - /etc/yum.repos.d/redhat.repo
    - /etc/yum.repos.d/remi.repo
    - /etc/yum.repos.d/mongodb-org-4.0.repo
