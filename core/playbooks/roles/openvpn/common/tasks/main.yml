---

- import_tasks: 00_preflight.yml
  tags:
    - add-vpn-client
    - gen-server-certs

- import_tasks: 05_init_pki.yml
  when: not existing_pki
  tags: add-vpn-client

- import_tasks: 10_setup_ca.yml
  when:
    - inventory_hostname == "localhost"
    - not existing_pki

- import_tasks: 15_server_certs.yml
  when:
    - inventory_hostname == "localhost"
    - not existing_pki
  tags: gen-server-certs

- import_tasks: 20_vpn_server_setup.yml
  when: inventory_hostname == "localhost"

- block:
    - import_tasks: 25_gen_certs.yml
    - import_tasks: 26_add_client.yml
  when: inventory_hostname == "localhost"
  tags: add-vpn-client

- import_tasks: 30_setup_clients.yml
  when: inventory_hostname in groups['sensors']
  tags: add-vpn-client

...
