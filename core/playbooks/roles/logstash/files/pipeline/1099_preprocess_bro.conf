filter {
  if "bro" in [tags] {
    if "conn" in [source] { mutate { add_field => { "type" => "bro_conn" } } }
    else if "dhcp" in [source] { mutate { add_field => { "type" => "bro_dhcp" } } }
    else if "dns" in [source] { mutate { add_field => { "type" => "bro_dns" } } }
    else if "dpd" in [source] { mutate { add_field => { "type" => "bro_dpd" } } }
    else if "smb_files" in [source] { mutate { add_field => { "type" => "bro_smb_files" } } }
    else if "ftp" in [source] { mutate { add_field => { "type" => "bro_ftp" } } }
    else if "http" in [source] { mutate { add_field => { "type" => "bro_http" } } }
    else if "irc" in [source] { mutate { add_field => { "type" => "bro_irc" } } }
    else if "kerberos" in [source] { mutate { add_field => { "type" => "bro_kerberos" } } }
    else if "notice" in [source] { mutate { add_field => { "type" => "bro_notice" } } }
    else if "rdp" in [source] { mutate { add_field => { "type" => "bro_rdp" } } }
    else if "signatures" in [source] { mutate { add_field => { "type" => "bro_signatures" } } }
    else if "smtp" in [source] { mutate { add_field => { "type" => "bro_smtp" } } }
    else if "snmp" in [source] { mutate { add_field => { "type" => "bro_snmp" } } }
    else if "software" in [source] { mutate { add_field => { "type" => "bro_software" } } }
    else if "ssh" in [source] { mutate { add_field => { "type" => "bro_ssh" } } }
    else if "ssl" in [source] { mutate { add_field => { "type" => "bro_ssl" } } }
    else if "syslog" in [source] { mutate { add_field => { "type" => "bro_syslog" } } }
    else if "tunnel" in [source] { mutate { add_field => { "type" => "bro_tunnel" } } }
    else if "weird" in [source] { mutate { add_field => { "type" => "bro_weird" } } }
    else if "mysql" in [source] { mutate { add_field => { "type" => "bro_mysql" } } }
    else if "socks" in [source] { mutate { add_field => { "type" => "bro_socks" } } }
    else if "x509" in [source] { mutate { add_field => { "type" => "bro_x509" } } }
    else if "intel" in [source] { mutate { add_field => { "type" => "bro_intel" } } }
    else if "modbus" in [source] { mutate { add_field => { "type" => "bro_modbus" } } }
    else if "sip" in [source] { mutate { add_field => { "type" => "bro_sip" } } }
    else if "radius" in [source] { mutate { add_field => { "type" => "bro_radius" } } }
    else if "pe" in [source] { mutate { add_field => { "type" => "bro_pe" } } }
    else if "rfb" in [source] { mutate { add_field => { "type" => "bro_rfb" } } }
    else if "dnp3" in [source] { mutate { add_field => { "type" => "bro_dnp3" } } }
    else if "files" in [source] { mutate { add_field => { "type" => "bro_files" } } }
    else if "smb_mapping" in [source] { mutate { add_field => { "type" => "bro_smb_mapping" } } }
    else if "ntlm" in [source] { mutate { add_field => { "type" => "bro_ntlm" } } }
    else if "dce_rpc" in [source] { mutate { add_field => { "type" => "bro_dce_rpc" } } }
    else { mutate { add_field => { "type" => "bro_unknown" } } }

    # Clean up some beats stuff we don't want
    mutate {
      remove_field => [ "host", "input", "prospector" ]
    }

    if [ts] {
      mutate {
        rename => { "ts" => "timestamp" }
      }
    }

    if [id.orig_h] or [id.resp_h] {
      mutate {
        rename => { "id.orig_h" => "source_ip" }
        rename => { "id.orig_p" => "source_port" }
        rename => { "id.resp_h" => "destination_ip" }
        rename => { "id.resp_p" => "destination_port" }
      }
    }
  }
}
