apiVersion: v1
kind: ConfigMap
metadata:
  namespace: metallb-system
  name: config
data:
  config: |
    address-pools:
{% if kube_virtual_ip is defined %}
    - name: api
      protocol: layer2
      addresses:
      - {{ kube_virtual_ip }}/32
      auto-assign: false
{% endif %}
    - name: default
      protocol: layer2
      avoid-buggy-ips: true
      addresses:
      - {{ kubernetes_services_cidr | ipaddr('2') | ipaddr('address') }}-{{ kubernetes_services_cidr | ipaddr('-1') | ipaddr('address') }}
{% if system_name == "GIP" %}
    - name: proxy
      protocol: layer2
      addresses:
      - 10.{{ gip_number }}.4.6/32
      auto-assign: false
{% endif %}
