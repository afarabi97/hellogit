---

- name: Update NodeSelector for CoreDNS to only deploy on server nodes
  shell:
    cmd: >
      kubectl patch deployment coredns -n kube-system --type='json'
      -p='[{"op":"remove","path":"/spec/template/spec/nodeSelector"},
      {"op":"add","path":"/spec/template/spec/nodeSelector","value":{ "role":"server" }}]'
  register: result
  changed_when: result.rc == 0

...
