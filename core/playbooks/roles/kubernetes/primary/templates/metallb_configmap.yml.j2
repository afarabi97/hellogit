apiVersion: v1
kind: ConfigMap
metadata:
  namespace: metallb-system
  name: config
data:
  config: |
    address-pools:
{% if kube_virtual_ip is defined %}
    - name: api
      protocol: layer2
      addresses:
      - {{ kube_virtual_ip }}/32
      auto-assign: false
{% endif %}
    - name: default
      protocol: layer2
      avoid-buggy-ips: true
      addresses:
      - {{ kubernetes_svc_first_ip }}-{{ kubernetes_svc_last_ip }}
