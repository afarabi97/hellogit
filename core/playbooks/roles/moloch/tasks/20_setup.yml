---

- name: Flush Config
  command: 'kubectl delete configmap moloch-bootstrap --ignore-not-found=true'

- name: Create ConfigMap
  shell: |
    kubectl create configmap moloch-bootstrap --from-file {{ moloch_dir }}/config.ini

- name: Run bootstrap job
  import_role:
    name: kubernetes/common
    tasks_from: kube_create
  vars:
    name: "Moloch Bootstrap"
    file_name: "{{ moloch_dir }}/bootstrap.yml"

- name: Wait for bootstrap to end
  shell: "kubectl wait job/moloch-bootstrap --for=condition=complete --timeout=-1s"

- name: Remove Bootstrap
  command: kubectl delete -f {{ moloch_dir }}/bootstrap.yml

- name: Flush Config
  command: 'kubectl delete configmap moloch-bootstrap --ignore-not-found=true'

...
