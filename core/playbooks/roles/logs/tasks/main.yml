---

- name: Generate list of hosts that need managed logs
  set_fact:
    loggers: "{{ groups['bro'] | union(groups['suricata']) }}"

- include_tasks: 01_prepare.yml
  when: inventory_hostname in groups['master_server']

- block:
  - name: Create directories
    file:
      path: "{{ logs_dir }}"
      owner: root
      group: root
      mode: u+rw,g+rw
      state: directory

  - include_tasks: 05_files_loggers.yml
    when: inventory_hostname in loggers

  - include_tasks: 06_files_master.yml
    when: inventory_hostname in groups['master_server']

  - include_tasks: 20_setup.yml
    when: inventory_hostname in groups['master_server']
  when: loggers | length > 0

...
