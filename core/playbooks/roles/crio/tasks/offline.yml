---
- set_fact:
    image_list: []

- set_fact:
    image_list: "{{ image_list + [item.image] }}"
  with_items:
    - "{{ kube_images }}"

- name: 'Download images from docker registry'
  shell: |
    buildah from {{ docker_registry_repo }}/{{ item[item.find('/')+1:] }}
  with_items:
    - "{{ image_list }}"
  when: "'k8s.gcr.io' in item or 'registry.opensuse.org' in item"

- name: 'Retag local images back to original name'
  shell: |
    buildah tag {{ docker_registry_repo }}/{{ item[item.find('/')+1:] }} {{ item }}
  with_items:
    - "{{ image_list }}"
  when: "'k8s.gcr.io' in item or 'registry.opensuse.org' in item"

...
