{
    "description": "Zeek DHCP pipeline",
    "processors": [
        {
            "set": {
                "field": "event.category",
                "value": "network"
            }
        },
        {
            "set": {
                "field": "network.protocol",
                "value": "dhcp"
            }
        },
        {
            "set": {
                "field": "network.transport",
                "value": "udp"
            }
        },
        {
            "rename": {
                "field": "uids",
                "target_field": "log.id.uids",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "event.id",
                "value": "{{log.id.uids}}"
            }
        },
        {
            "set": {
                "field": "source.address",
                "value": "{{client_addr}}",
                "if": "ctx.client_addr != null"
            }
        },
        {
            "rename": {
                "field": "client_addr",
                "target_field": "source.ip",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "destination.address",
                "value": "{{server_addr}}",
                "if": "ctx.server_addr != null"
            }
        },
        {
            "rename": {
                "field": "server_addr",
                "target_field": "destination.ip",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "host_name",
                "target_field": "source.hostname",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "lease_time",
                "target_field": "dhcp.lease_time",
                "ignore_missing": true
            }
        },
        {
            "convert": {
                "field": "dhcp.lease_time",
                "type": "float",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "agent_remote_id",
                "target_field": "dhcp.agent_remote_id",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "assigned_addr",
                "target_field": "dhcp.assigned_addr",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "circuit_id",
                "target_field": "dhcp.circuit_id",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "client_message",
                "target_field": "dhcp.client_message",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "client_fqdn",
                "target_field": "source.fqdn",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "mac",
                "target_field": "source.mac",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "msg_orig",
                "target_field": "dhcp.msg_orig",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "msg_types",
                "target_field": "dhcp.msg_types",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "source.port",
                "value": 68
            }
        },
        {
            "set": {
                "field": "destination.port",
                "value": 67
            }
        },
        {
            "rename": {
                "field": "requested_addr",
                "target_field": "dhcp.requested_addr",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "server_message",
                "target_field": "dhcp.server_message",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "domain",
                "target_field": "source.domain",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "subscriber_id",
                "target_field": "dhcp.subscriber_id",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "client_software",
                "target_field": "dhcp.client_software",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "source.software.original",
                "value": "{{dhcp.client_software}}",
                "if": "ctx.dhcp.client_software != null"
            }
        },
        {
            "rename": {
                "field": "server_software",
                "target_field": "dhcp.server_software",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "destination.software.original",
                "value": "{{dhcp.server_software}}",
                "if": "ctx.dhcp.server_software != null"
            }
        },
        {
            "set": {
                "field": "network.transport",
                "value": "udp"
            }
        },
        {
            "convert": {
                "field": "duration",
                "type": "float",
                "if": "ctx.duration != null"
            }
        },
        {
            "rename": {
                "field": "duration",
                "target_field": "event.duration",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "network.name",
                "value": "{{domain}}",
                "if": "ctx.domain != null"
            }
        },
        {
            "set": {
                "field": "network.protocol",
                "value": "dhcp"
            }
        }
    ],
    "on_failure": [
        {
            "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
            }
        }
    ]
}
