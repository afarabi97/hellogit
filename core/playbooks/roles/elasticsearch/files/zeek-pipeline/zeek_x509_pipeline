{
    "description": "Zeek x509 pipeline",
    "processors": [
        {
            "set": {
                "field": "event.category",
                "value": "files"
            }
        },
        {
            "date": {
                "field": "certificate_not_valid_after",
                "target_field": "x509.certificate.valid.until",
                "formats": [
                    "ISO8601"
                ]
            }
        },
        {
            "date": {
                "field": "certificate_not_valid_after",
                "target_field": "tls.server_certificate.not_after",
                "formats": [
                    "ISO8601"
                ]
            }
        },
        {
            "date": {
                "field": "certificate_not_valid_before",
                "target_field": "x509.certificate.valid.from",
                "formats": [
                    "ISO8601"
                ]
            }
        },
        {
            "set": {
                "field": "event.id",
                "value": "{{id}}"
            }
        },
        {
            "set": {
                "field": "log.id.id",
                "value": "{{id}}"
            }
        },
        {
            "remove": {
                "field": [
                    "id",
                    "certificate_not_valid_after",
                    "certificate_not_valid_before"
                ]
            }
        },
        {
            "rename": {
                "field": "certificate_curve",
                "target_field": "x509.certificate.curve",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "basic_constraints_ca",
                "target_field": "x509.basic_constraints.certificate_authority",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "basic_constraints_path_len",
                "target_field": "x509.basic_constraints.path_length",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_cn",
                "target_field": "x509.certificate.common_name",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_exponent",
                "target_field": "certificate.exponent",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_key_alg",
                "target_field": "x509.certificate.key.algorithm",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_key_length",
                "target_field": "x509.certificate.key.length",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_key_type",
                "target_field": "x509.certificate.key.type",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_serial",
                "target_field": "certificate.serial",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_sig_alg",
                "target_field": "x509.certificate.signature_algorithm",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_issuer",
                "target_field": "certificate.iss",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "x509.certificate.issuer.text",
                "value": "{{certificate.iss}}"
            }
        },
        {
            "gsub": {
                "field": "certificate.iss",
                "pattern": "\\\\,",
                "replacement": "",
                "ignore_missing": true
            }
        },
        {
            "kv": {
                "field": "certificate.iss",
                "field_split": ",",
                "value_split": "=",
                "target_field": "x509.certificate.issuer",
                "ignore_missing": true
            }
        },
        {
            "remove": {
                "field": "certificate.iss",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.issuer.C",
                "target_field": "x509.certificate.issuer.country",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.issuer.CN",
                "target_field": "x509.certificate.issuer.common_name",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.issuer.L",
                "target_field": "x509.certificate.issuer.locality",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.issuer.O",
                "target_field": "x509.certificate.issuer.organization",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.issuer.OU",
                "target_field": "x509.certificate.issuer.organizational_unit",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.issuer.ST",
                "target_field": "x509.certificate.issuer.state",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_subject",
                "target_field": "certificate.sub",
                "ignore_missing": true
            }
        },
        {
            "set": {
                "field": "x509.certificate.subject.text",
                "value": "{{certificate.sub}}"
            }
        },
        {
            "gsub": {
                "field": "certificate.sub",
                "pattern": "\\\\,",
                "replacement": "",
                "ignore_missing": true
            }
        },
        {
            "kv": {
                "field": "certificate.sub",
                "field_split": ",",
                "value_split": "=",
                "target_field": "x509.certificate.subject",
                "ignore_missing": true
            }
        },
        {
            "remove": {
                "field": "certificate.sub",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.subject.C",
                "target_field": "x509.certificate.subject.country",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.subject.CN",
                "target_field": "x509.certificate.subject.common_name",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.subject.L",
                "target_field": "x509.certificate.subject.locality",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.subject.O",
                "target_field": "x509.certificate.subject.organization",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.subject.OU",
                "target_field": "x509.certificate.subject.organizational_unit",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "x509.certificate.subject.ST",
                "target_field": "x509.certificate.subject.state",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "certificate_version",
                "target_field": "x509.certificate.version",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "logcert",
                "target_field": "x509.logcert",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "san_dns",
                "target_field": "san.dns",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "san_email",
                "target_field": "san.email",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "san_ip",
                "target_field": "san.ip",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "san_uri",
                "target_field": "san.url",
                "ignore_missing": true
            }
        },
        {
            "dot_expander": {
                "field": "san.uri",
                "path": "x509"
            }
        },
        {
            "dot_expander": {
                "field": "san.ip",
                "path": "x509"
            }
        },
        {
            "dot_expander": {
                "field": "san.email",
                "path": "x509"
            }
        },
        {
            "dot_expander": {
                "field": "san.dns",
                "path": "x509"
            }
        },
        {
            "dot_expander": {
                "field": "certificate.version",
                "path": "x509"
            }
        },
        {
            "dot_expander": {
                "field": "certificate.serial",
                "path": "x509"
            }
        },
        {
            "dot_expander": {
                "field": "certificate.exponent",
                "path": "x509"
            }
        }
    ],
    "on_failure": [
        {
            "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
            }
        }
    ]
}
