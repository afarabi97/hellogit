{
    "description": "Pipeline for normalizing Zeek stats.log",
    "processors": [
        {
            "date": {
                "field": "ts",
                "formats": [
                    "ISO8601"
                ],
                "ignore_failure": true
            }
        },
        {
            "remove": {
                "field": "ts",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "mem",
                "target_field": "stats.memory",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "pkts_proc",
                "target_field": "stats.packets.processed",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "pkts_dropped",
                "target_field": "stats.packets.dropped",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "pkts_link",
                "target_field": "stats.packets.received",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "bytes_recv",
                "target_field": "stats.bytes.received",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "tcp_conns",
                "target_field": "stats.connections.tcp.count",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "active_tcp_conns",
                "target_field": "stats.connections.tcp.active",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "udp_conns",
                "target_field": "stats.connections.udp.count",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "active_udp_conns",
                "target_field": "stats.connections.udp.active",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "icmp_conns",
                "target_field": "stats.connections.icmp.count",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "active_icmp_conns",
                "target_field": "stats.connections.icmp.active",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "events_proc",
                "target_field": "stats.events.processed",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "events_queued",
                "target_field": "stats.events.queued",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "timers",
                "target_field": "stats.timers.count",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "active_timers",
                "target_field": "stats.timers.active",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "files",
                "target_field": "stats.files.count",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "active_files",
                "target_field": "stats.files.active",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "dns_requests",
                "target_field": "stats.dns_requests.count",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "active_dns_requests",
                "target_field": "stats.dns_requests.active",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "reassem_tcp_size",
                "target_field": "stats.reassembly_size.tcp",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "reassem_file_size",
                "target_field": "stats.reassembly_size.file",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "reassem_frag_size",
                "target_field": "stats.reassembly_size.frag",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "reassem_unknown_size",
                "target_field": "stats.reassembly_size.unknown",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "pkt_lag",
                "target_field": "stats.timestamp_lag",
                "ignore_missing": true
            }
        },
        {
            "rename": {
                "field": "peer",
                "target_field": "stats.peer",
                "ignore_missing": true
            }
        }
    ],
    "on_failure": [
        {
            "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
            }
        }
    ]
}
