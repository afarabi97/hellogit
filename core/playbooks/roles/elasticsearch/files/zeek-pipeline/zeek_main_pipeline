{
    "description": "A pipeline of pipelines for Zeek log files",
    "version": 1,
    "processors": [
        {
            "drop": {
                "if": "ctx.event.dataset != 'conn' && ctx.event.dataset != 'dce_rpc' && ctx.event.dataset != 'dhcp' && ctx.event.dataset != 'dnp3' && ctx.event.dataset != 'dns' && ctx.event.dataset != 'dpd' && ctx.event.dataset != 'files' && ctx.event.dataset != 'ftp' && ctx.event.dataset != 'http' && ctx.event.dataset != 'intel' && ctx.event.dataset != 'irc' && ctx.event.dataset != 'kerberos' && ctx.event.dataset != 'modbus' && ctx.event.dataset != 'mysql' && ctx.event.dataset != 'notice' && ctx.event.dataset != 'ntlm' && ctx.event.dataset != 'pe' && ctx.event.dataset != 'radius' && ctx.event.dataset != 'rdp' && ctx.event.dataset != 'rfb' && ctx.event.dataset != 'sip' && ctx.event.dataset != 'smb_cmd' && ctx.event.dataset != 'smb_files' && ctx.event.dataset != 'smb_mapping' && ctx.event.dataset != 'smtp' && ctx.event.dataset != 'snmp' && ctx.event.dataset != 'socks' && ctx.event.dataset != 'software' && ctx.event.dataset != 'ssh' && ctx.event.dataset != 'ssl' && ctx.event.dataset != 'syslog' && ctx.event.dataset != 'traceroute' && ctx.event.dataset != 'tunnel' && ctx.event.dataset != 'weird' && ctx.event.dataset != 'x509' && ctx.event.dataset != 'stats'"
            }
        },
        {
            "set": {
                "field": "event.created",
                "value": "{{_ingest.timestamp}}"
            }
        },
        {
            "pipeline": {
                "name": "zeek_general_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'conn'",
                "name": "zeek_conn_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'dce_rpc'",
                "name": "zeek_dce_rpc_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'dhcp'",
                "name": "zeek_dhcp_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'dnp3'",
                "name": "zeek_dnp3_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'dns'",
                "name": "zeek_dns_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'dpd'",
                "name": "zeek_dpd_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'files'",
                "name": "zeek_files_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'ftp'",
                "name": "zeek_ftp_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'http'",
                "name": "zeek_http_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'intel'",
                "name": "zeek_intel_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'irc'",
                "name": "zeek_irc_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'kerberos'",
                "name": "zeek_kerberos_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'modbus'",
                "name": "zeek_modbus_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'mysql'",
                "name": "zeek_mysql_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'notice'",
                "name": "zeek_notice_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'ntlm'",
                "name": "zeek_ntlm_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'pe'",
                "name": "zeek_pe_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'radius'",
                "name": "zeek_radius_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'rdp'",
                "name": "zeek_rdp_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'rfb'",
                "name": "zeek_rfb_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'sip'",
                "name": "zeek_sip_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'smb_cmd'",
                "name": "zeek_smb-cmd_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'smb_files'",
                "name": "zeek_smb-files_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'smb_mapping'",
                "name": "zeek_smb-mapping_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'smtp'",
                "name": "zeek_smtp_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'snmp'",
                "name": "zeek_snmp_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'socks'",
                "name": "zeek_socks_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'software'",
                "name": "zeek_software_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'ssh'",
                "name": "zeek_ssh_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'ssl'",
                "name": "zeek_ssl_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'syslog'",
                "name": "zeek_syslog_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'traceroute'",
                "name": "zeek_traceroute_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'tunnel'",
                "name": "zeek_tunnel_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'weird'",
                "name": "zeek_weird_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'x509'",
                "name": "zeek_x509_pipeline"
            }
        },
        {
            "pipeline": {
                "if": "ctx.event.dataset == 'stats'",
                "name": "zeek_stats_pipeline"
            }
        },
        {
            "set": {
                "field": "host.name",
                "value": "{{observer.hostname}}",
                "if": "ctx.observer.hostname != null"
            }
        }
    ],
    "on_failure": [
        {
            "set": {
                "field": "error.message",
                "value": "{{ _ingest.on_failure_message }}"
            }
        }
    ]
}
