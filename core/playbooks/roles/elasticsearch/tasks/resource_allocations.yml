---

- name: Set Common Resources Allocations
  set_fact:
    master_count: 3
    coordinating_count: 1
    enable_ml: True
    enable_maps: True
    mdil: False

# - name: Multiple Masters if more than 2 servers are available
#   set_fact:
#     master_count: 3
#   when: groups['servers']|length > 2

- name: Set Elastic Resource Allocations for DIP
  block:
  - name: Set Defaults
    set_fact:
      master_java_memory: 1
      master_memory: 1
      master_num_procs: "1000m"
      data_java_memory: 1
      data_memory: 1
      data_num_procs: "1000m"
      data_count: "{{ groups['servers']|length * 2 }}"
      coordinating_java_memory: 1
      coordinating_memory: 1
      coordinating_num_procs: "1000m"
      ml_count: 1
      ml_memory: 1
      ml_java_memory: 1
      ml_num_procs: "1000m"
  - name: Small Form Factor
    set_fact:
      master_java_memory: 15
      master_memory: 15
      master_num_procs: "1000m"
      ingest_java_memory: 31
      ingest_memory: 64
      ingest_num_procs: "16000m"
      ingest_count: "{{ groups['servers']|length * 2 }}"
      data_java_memory: 31
      data_memory: 64
      data_num_procs: "24000m"
      data_count: "{{ groups['servers']|length * 3 }}"
      coordinating_java_memory: 31
      coordinating_memory: 45
      coordinating_num_procs: "3000m"
      ml_count: "{{ groups['servers']|length }}"
      ml_memory: 64
      ml_java_memory: 24
      ml_num_procs: "8000m"
    when: kit_size == 4
  - name: R440 Common Node
    set_fact:
      master_java_memory: 15
      master_memory: 15
      master_num_procs: "1000m"
      data_java_memory: 31
      data_memory: 64
      data_num_procs: "14000m"
      data_count: "{{ groups['servers']|length * 3 }}"
      coordinating_java_memory: 31
      coordinating_memory: 45
      coordinating_num_procs: "3000m"
      ml_count: "{{ groups['servers']|length }}"
      ml_memory: 64
      ml_java_memory: 31
      ml_num_procs: "8000m"
    when: kit_size == 3
  - name: R440 Legacy Node
    set_fact:
      master_java_memory: 15
      master_memory: 15
      master_num_procs: "1000m"
      data_java_memory: 31
      data_memory: 64
      data_num_procs: "14000m"
      data_count: "{{ groups['servers']|length * 2 }}"
      coordinating_java_memory: 31
      coordinating_memory: 45
      coordinating_num_procs: "3000m"
      ml_count: "{{ groups['servers']|length }}"
      ml_memory: 64
      ml_java_memory: 31
      ml_num_procs: "6000m"
    when: kit_size == 2
  - name: CPT DL160
    set_fact:
      enable_ml: False
      master_java_memory: 15
      master_memory: 15
      master_num_procs: "1000m"
      data_java_memory: 31
      data_memory: 64
      data_num_procs: "12000m"
      data_count: "{{ groups['servers']|length * 2 }}"
      coordinating_java_memory: 31
      coordinating_memory: 64
      coordinating_num_procs: "3000m"
    when: kit_size == 1
  - name: MDT DL160
    set_fact:
      enable_ml: False
      master_java_memory: 8
      master_memory: 8
      master_num_procs: "1000m"
      data_java_memory: 24
      data_memory: 24
      data_num_procs: "12000m"
      data_count: "{{ groups['servers']|length * 2 }}"
      coordinating_java_memory: 8
      coordinating_memory: 8
      coordinating_num_procs: "3000m"
    when: kit_size == 0

# TODO go back and fix this.
# - name: Set Elastic Resource Allocations for GIP
#   block:
#   - name: Set Defaults for VM Setup (for testing only)
#     set_fact:
#       master_memory: 4
#       master_java_memory: 2
#       master_num_procs: "2000m"
#       data_count: 6
#       data_memory: 4
#       data_java_memory: 2
#       data_num_procs: "4000m"
#       coordinating_memory: 2
#       coordinating_java_memory: 1
#       coordinating_num_procs: "2000m"
#       ml_memory: 2
#       ml_java_memory: 1
#       ml_num_procs: "2000m"
#       ml_count: 2
#   - name: GIP Gen1
#     set_fact:
#       master_memory: 24
#       master_java_memory: 24
#       master_num_procs: "4000m"
#       data_count: "{{ groups['servers']|length * 1 }}"
#       data_memory: 31
#       data_java_memory: 64
#       data_num_procs: "14000m"
#       coordinating_memory: 31
#       coordinating_java_memory: 64
#       coordinating_num_procs: "4000m"
#       ml_memory: 64
#       ml_java_memory: 31
#       ml_num_procs: "8000m"
#       ml_count: 4
#     when: kit_size == 100
#   when: system_name == "GIP"

- name: Set Index Rollover Size
  set_fact:
    index_rollover_size: "{{ data_count * 50 }}"
