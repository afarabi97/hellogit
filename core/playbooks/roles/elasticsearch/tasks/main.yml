---
- name: Set Default ES Install Variable
  set_fact:
    es_installed: false

- import_tasks: "preflight.yml"
  when: inventory_hostname in groups['master_server']

- import_tasks: "uninstall.yml"
  when: inventory_hostname in groups['master_server'] and es_installed

- import_tasks: "reset_data.yml"
- import_tasks: "setup_data_dir.yml"
- import_tasks: "setup_plugins.yml"

- import_tasks: "resource_allocations.yml"
  when: inventory_hostname in groups['master_server']
  tags:
    - es-post-install
    - load-ml

- import_tasks: "install.yml"
  when: inventory_hostname in groups['master_server']

- import_tasks: "post_install.yml"
  when: inventory_hostname in groups['master_server']
  tags: es-post-install

- import_tasks: "load_ml.yml"
  when: inventory_hostname in groups['master_server'] and enable_ml
  tags: load-ml
