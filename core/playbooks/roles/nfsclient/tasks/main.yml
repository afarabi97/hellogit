---

- name: Mount the nfshare in client side
  mount:
    fstype: nfs
    opts: defaults
    state: mounted
    src: "{{ nfs_server_host }}:/tfplenum_backup"
    path: "{{ backup_mount_point }}"

- name: "Check mount point {{ backup_mount_point }}"
  command: mountpoint {{ backup_mount_point }}
  register: mount_stat

- fail:
    msg: "Failed to mount the shared folder to {{ backup_mount_point }}"
  when: mount_stat.stdout == "{{ backup_mount_point }} is not a mountpoint"

- name: Create snapshots folder after mount
  file:
    path: "{{ backup_mount_point }}/elastic_snapshots"
    state: directory
    group: "{{ elastic_group }}"
    owner: "{{ elastic_user }}"
    mode: "0775"

...
