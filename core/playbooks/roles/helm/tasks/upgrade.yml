- name: Checking Current Helm Version
  shell: set -o pipefail && helm version -c | grep '^Client' | cut -d'"' -f2
  register: OLD_VERSION
  changed_when: OLD_VERSION.rc == 0
- block:
  - debug:
      msg: "Nothing to Upgrade, exiting."
  - meta: end_play
  when:
    - OLD_VERSION.stdout | version(helm_version,'>=')
    - inventory_hostname in groups['master_server']

- name: Downloading and Unpacking Helm
  unarchive:
    src: "{{ offline_repo_base }}/helm-{{ helm_version }}-linux-amd64.tar.gz"
    dest: /usr/local/bin/
    remote_src: yes
    extra_opts:
      - linux-amd64/helm
