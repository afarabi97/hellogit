---

- import_tasks: uninstall.yml
  when: inventory_hostname in groups['master_server']

- import_tasks: install.yml
  when: inventory_hostname in groups['master_server']

- name: Create directory
  file:
    path: "/root/.config/helm/"
    owner: "root"
    group: "root"
    mode: 0755
    state: directory

- name: Copy Repo Config
  template:
    src: templates/repositories.yaml
    dest: /root/.config/helm/repositories.yaml
    mode: 0644
    owner: root
    group: root

- import_tasks: load_charts.yml
  when: inventory_hostname == "localhost"
  tags: build-load-charts

- name: update helm repo
  shell: |
    helm repo update
  register: results
  changed_when: results.rc == 0
