---

- name: Remove Chartmuseum
  shell: |
    helm delete chartmuseum

- name: Wait for chartmuseum to be removed
  shell: |
    kubectl wait --for=condition=delete deployment/chartmuseum-chartmuseum
  ignore_errors: true

- name: Delete directory
  file:
    path: "{{chartmuseum_data_dir}}"
    state: absent

- name: Remove Chartmuseum Certificate
  command: "{{ item }}"
  ignore_errors: true
  with_items:
    - "kubectl delete certificate chartmuseum --ignore-not-found=true"
    - "kubectl delete secret chartmuseum-certificate --ignore-not-found=true"
