---

- name: Delete existing config directory
  file:
    path: "{{ suricata_dir }}"
    state: absent

- name: Create directories
  file:
    path: "{{ suricata_dir }}/{{ item }}"
    owner: root
    group: root
    mode: u+rw,g+rw
    state: directory
  loop: ['rules', 'lua-output']

- name: Copy dummy lua script
  copy:
    src: "files/script1.lua"
    dest: "{{ suricata_dir }}/lua-output/script1.lua"
    owner: root
    group: root
    mode: 0644

- name: Create dummy rule file
  file:
    path: "{{ suricata_dir }}/rules/suricata.rules"
    owner: root
    group: root
    mode: u+rw,g+rw
    state: touch

- name: Setup configs
  template:
    src: "templates/suricata.yaml.j2"
    dest: "{{ suricata_dir }}/suricata.yaml"
    group: root
    owner: root
    mode: 0644
  when: inventory_hostname in groups['suricata']

- name: Setup deployment configs
  template:
    src: "templates/deploy.yml.j2"
    dest: "{{ suricata_dir }}/{{ item }}-deploy.yml"
    owner: root
    group: root
    mode: 0644
  vars:
    deployment_hostname: "{{ item }}"
  loop: "{{ groups['suricata'] }}"
  when: inventory_hostname in groups['master-server']

...
