---

############################################
# Checking that required variables are set #
############################################

- name: Checking run_option is Set
  fail:
    msg: 'Run option is not defined properly. Run option needs to be set to install, reinstall, uninstall, or upgrade. i.e. --extra-vars "run_option=install"'
  when: run_option not in ['install', 'uninstall', 'reinstall', 'upgrade'] or run_option is not defined or run_option is none

- name: Check if remote_sensors is defined
  fail:
    msg: 'Verify you have the remote_sensors group in your inventory file. It must be defined. See sample inventory. If you have no remote sensors you can define an empty group with just remote-senors: under nodes.'
  when: "'remote_sensors' not in groups"

- name: Check if servers is defined
  fail:
    msg: 'Verify you have the servers group in your inventory file. It must be defined. See sample inventory. If you have no servers you can define an empty group with just servers: under nodes.'
  when: "'servers' not in groups"

- name: Checking that management_ipv4 is set
  fail:
    msg: "management_ipv4 is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: management_ipv4 is not defined or management_ipv4 is none

- name: Checking that home_net is set
  fail:
    msg: "home_net is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: home_net is not defined or home_net is none

- name: Checking that kubernetes_services_cidr is set
  fail:
    msg: "kubernetes_services_cidr is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: kubernetes_services_cidr is not defined or kubernetes_services_cidr is none

- name: Checking that moloch_bpf is set
  fail:
    msg: "moloch_bpf is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_bpf is not defined or moloch_bpf is none

- name: Checking that logstash_cpu_request is set
  fail:
    msg: "logstash_cpu_request is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: logstash_cpu_request is not defined or logstash_cpu_request is none

- name: Checking that moloch_dontSaveBPFs is set
  fail:
    msg: "moloch_dontSaveBPFs is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_dontSaveBPFs is not defined or moloch_dontSaveBPFs is none

- name: Checking that bro_wokers is set
  fail:
    msg: "bro_workers is not defined. Make sure it is defined in your inventory file. See sample inventory for help. This host is in the bro group and subsequently must have a bro workers count. Keep in mind bro_workers must be non-zero. If you want to get rid of bro, take the host out of the bro group."
  when: inventory_hostname in groups['bro'] and (bro_workers is not defined or bro_wokers is none or (bro_workers | int) == 0)

- name: Checking that moloch_spiDataMaxIndices is set
  fail:
    msg: "moloch_spiDataMaxIndices is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_spiDataMaxIndices is not defined or moloch_spiDataMaxIndices is none

- name: Checking that moloch_pcapWriteMethod is set
  fail:
    msg: "moloch_pcapWriteMethod is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_pcapWriteMethod is not defined or moloch_pcapWriteMethod is none

- name: Checking that moloch_packet_v3_block_size is set
  fail:
    msg: "moloch_packet_v3_block_size is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_packet_v3_block_size is not defined or moloch_packet_v3_block_size is none

- name: Checking that moloch_packet_v3_num_threads is set
  fail:
    msg: "moloch_packet_v3_num_threads is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_packet_v3_num_threads is not defined or moloch_packet_v3_num_threads is none

- name: Checking that moloch_pcapWriteSize is set
  fail:
    msg: "moloch_pcapWriteSize is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_pcapWriteSize is not defined or moloch_pcapWriteSize is none

- name: Checking that moloch_pcapWriteMethod is set
  fail:
    msg: "moloch_pcapWriteMethod is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_pcapWriteMethod is not defined or moloch_pcapWriteMethod is none

- name: Checking that moloch_maxESConns is set
  fail:
    msg: "moloch_maxESConns is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_maxESConns is not defined or moloch_maxESConns is none

- name: Checking that moloch_maxESRequests is set
  fail:
    msg: "moloch_maxESRequests is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_maxESRequests is not defined or moloch_maxESRequests is none

- name: Checking that moloch_packetsPerPoll is set
  fail:
    msg: "moloch_packetsPerPoll is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_packetsPerPoll is not defined or moloch_packetsPerPoll is none

- name: Checking that moloch_magicMode is set
  fail:
    msg: "moloch_magicMode is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_magicMode is not defined or moloch_magicMode is none

- name: Checking that moloch_maxPacketsInQueue is set
  fail:
    msg: "moloch_maxPacketsInQueue is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: moloch_maxPacketsInQueue is not defined or moloch_maxPacketsInQueue is none

- name: Checking that fpc_path is set
  fail:
    msg: "fpc_path is not defined. Make sure it is defined in your inventory file. See sample inventory for help. You do not have to provide a value, but it must exist in the inventory file. Add fpc_path: to inventory in all vars to resolve this error."
  when: fpc_path is not defined

- name: Checking that moloch_threads is set
  fail:
    msg: "moloch_threads is not defined. Make sure it is defined in your inventory file. See sample inventory for help."
  when: inventory_hostname in groups['sensors'] and moloch_threads is not defined or moloch_threads is none

...
